{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\kgrob\\\\Documents\\\\Proyectos de programaci\\xF3n\\\\OrgBoat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\kgrob\\\\Documents\\\\Proyectos de programaci\\xF3n\\\\OrgBoat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import socketIOClient from\"socket.io-client\";var ENDPOINT=\"http://localhost:5000\";function ChatBodyMessage(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),newMessage=_useState2[0],setnewMessage=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chatMessages=_useState4[0],setChatMessages=_useState4[1];var messages=[].concat(chatMessages).reverse();var socket=socketIOClient(ENDPOINT);var actualLabelDate=\"\";var message_user_uid;var pphoto=\"\";var name=\"\";var p;var chat_uid=props.chat_uid;var my_uid=props.my_uid;useEffect(function(){socket.on(\"chat message\",function(response){setChatMessages(function(chatMessages){return[].concat(_toConsumableArray(chatMessages),[response]);});console.log(\"estesi\",response);socket.emit(\"get chats\");});},[]);function timeformat(date){var h=date.getHours();var m=date.getMinutes();var x=h>=12?\"PM\":\"AM\";h=h%12;h=h?h:12;m=m<10?\"0\"+m:m;var mytime=h+\":\"+m+\" \"+x;return mytime;}function getDateLabel(date){var dateLabelDate=date.getDate()<10?\"0\"+date.getDate():date.getDate();var dateLabelMonth=date.getMonth()+1<10?\"0\"+(date.getMonth()+1):date.getMonth()+1;var dateLabelYear=date.getFullYear();var dateLabel=dateLabelDate+\"/\"+dateLabelMonth+\"/\"+dateLabelYear;return dateLabel;}function getPhoto(){if(my_uid!=messages[0].message_user_uid){pphoto=messages[0].pphoto;name=messages[0].name;}if(pphoto==\"\"){return/*#__PURE__*/React.createElement(\"span\",{className:\"avatar-title bg-info rounded-circle\"},name.substring(0,1));}else{return/*#__PURE__*/React.createElement(\"img\",{src:\"pphotoChat/\"+name,className:\"rounded-circle\",alt:\"image\"});}}var dateSend=new Date(messages[0].length>0?messages[0].time:messages);var yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);var yesterdayLabel=getDateLabel(yesterday);var todayLabel=getDateLabel(new Date());function getTodayLabel(dateLabel){if(dateLabel==yesterdayLabel){dateLabel=\"Ayer\";}else if(dateLabel==todayLabel){dateLabel=\"Hoy\";}if(actualLabelDate==dateLabel){return\"\";}else{actualLabelDate=dateLabel;return/*#__PURE__*/React.createElement(\"div\",{className:\"message-item messages-divider sticky-top\",\"data-label\":actualLabelDate});}}function SendMessage(event){event.preventDefault();var socket=socketIOClient(ENDPOINT);if(newMessage.length>0){socket.emit(\"chat message\",{chat:chat_uid,message:newMessage});socket.emit(\"get chats\");socket.emit(\"get messages\",{id:chat_uid,page:props.currentPage});setnewMessage(\"\");}}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header-user\"},getPhoto()),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header-action\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"list-inline\"},/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item d-xl-none d-inline\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light mobile-navigation-button\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fal fa-ellipsis-h-alt\"}))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\",\"data-toggle\":\"tooltip\",title:\"Voice call\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light text-success\",\"data-toggle\":\"modal\",\"data-target\":\"#call\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-phone\"}))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\",\"data-toggle\":\"tooltip\",title:\"Video call\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light text-warning\",\"data-toggle\":\"modal\",\"data-target\":\"#videoCall\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-video\"}))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light\",\"data-toggle\":\"dropdown\"},/*#__PURE__*/React.createElement(\"i\",{className:\"ti-more\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-menu dropdown-menu-right\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",\"data-navigation-target\":\"contact-information\",className:\"dropdown-item\"},\"Profile\"),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item\"},\"Add to archive\"),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item\"},\"Delete\"),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-divider\"}),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item text-danger\"},\"Block\")))))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"messages\"},messages.map(function(message,index){message_user_uid=message.message_user_uid;dateSend=new Date(message.time);var timeSend=timeformat(dateSend);var out=my_uid==message_user_uid?\"outgoing-message\":\"\";var ticks=my_uid==message_user_uid?/*#__PURE__*/React.createElement(\"i\",{className:\"ti-check\"}):\"\";// double checked\nvar usrname=message.chat_type==1&&my_uid!=message_user_uid?message.name:\"\";return/*#__PURE__*/React.createElement(\"div\",{className:\"messages-container\",key:index+1},getTodayLabel(getDateLabel(dateSend)),/*#__PURE__*/React.createElement(\"div\",{className:\"message-item \"+out},usrname,/*#__PURE__*/React.createElement(\"div\",{className:\"message-content\"},message.message,/*#__PURE__*/React.createElement(\"div\",{class:\"btn action-toggle\"},/*#__PURE__*/React.createElement(\"div\",{class:\"dropdown\"},/*#__PURE__*/React.createElement(\"a\",{className:\"text-light\",\"data-toggle\":\"dropdown\",href:\"#\"},/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-ellipsis-h\"})),/*#__PURE__*/React.createElement(\"div\",{class:\"dropdown-menu dropdown-menu-left\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",class:\"dropdown-item\"},\"Delete\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-avatar\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"time\"},timeSend,\" \",ticks,/*#__PURE__*/React.createElement(\"i\",{className:\"ti-check\"})))))));}))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-footer\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(event){return SendMessage(event,newMessage,chat_uid);}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light mr-3\",\"data-toggle\":\"tooltip\",title:\"Emoji\",type:\"button\"},/*#__PURE__*/React.createElement(\"i\",{className:\"ti-face-smile\"}))),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",placeholder:\"Write a message.\",value:newMessage,onChange:function onChange(e){return setnewMessage(e.target.value);}}),/*#__PURE__*/React.createElement(\"div\",{className:\"form-buttons\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light\",\"data-toggle\":\"tooltip\",title:\"Add files\",type:\"button\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-paperclip\"})),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light d-sm-none d-block\",\"data-toggle\":\"tooltip\",title:\"Send a voice record\",type:\"button\"},/*#__PURE__*/React.createElement(\"i\",{\"data-feather\":\"mic\"})),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\",type:\"submit\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-paper-plane\"}))))));}export default ChatBodyMessage;","map":{"version":3,"sources":["C:/Users/kgrob/Documents/Proyectos de programaci√≥n/OrgBoat/src/components/ChatBodyMessage.js"],"names":["React","useState","useEffect","socketIOClient","ENDPOINT","ChatBodyMessage","props","newMessage","setnewMessage","chatMessages","setChatMessages","messages","concat","reverse","socket","actualLabelDate","message_user_uid","pphoto","name","p","chat_uid","my_uid","on","response","console","log","emit","timeformat","date","h","getHours","m","getMinutes","x","mytime","getDateLabel","dateLabelDate","getDate","dateLabelMonth","getMonth","dateLabelYear","getFullYear","dateLabel","getPhoto","substring","dateSend","Date","length","time","yesterday","setDate","yesterdayLabel","todayLabel","getTodayLabel","SendMessage","event","preventDefault","chat","message","id","page","currentPage","map","index","timeSend","out","ticks","usrname","chat_type","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport socketIOClient from \"socket.io-client\";\r\nconst ENDPOINT = \"http://localhost:5000\";\r\n\r\nfunction ChatBodyMessage(props) {\r\n  const [newMessage, setnewMessage] = useState([]);\r\n  const [chatMessages, setChatMessages] = useState([]);\r\n\r\n  let messages = [].concat(chatMessages).reverse();\r\n  const socket = socketIOClient(ENDPOINT);\r\n\r\n  let actualLabelDate = \"\";\r\n  let message_user_uid;\r\n  let pphoto = \"\";\r\n  let name = \"\";\r\n  let p;\r\n  let chat_uid = props.chat_uid;\r\n  let my_uid = props.my_uid;\r\n\r\n  useEffect(() => {\r\n    socket.on(\"chat message\", (response) => {\r\n      setChatMessages((chatMessages) => [...chatMessages, response]);\r\n      console.log(\"estesi\", response);\r\n      socket.emit(\"get chats\");\r\n    });\r\n  }, []);\r\n\r\n  function timeformat(date) {\r\n    var h = date.getHours();\r\n    var m = date.getMinutes();\r\n    var x = h >= 12 ? \"PM\" : \"AM\";\r\n    h = h % 12;\r\n    h = h ? h : 12;\r\n    m = m < 10 ? \"0\" + m : m;\r\n    var mytime = h + \":\" + m + \" \" + x;\r\n    return mytime;\r\n  }\r\n\r\n  function getDateLabel(date) {\r\n    let dateLabelDate =\r\n      date.getDate() < 10 ? \"0\" + date.getDate() : date.getDate();\r\n    let dateLabelMonth =\r\n      date.getMonth() + 1 < 10\r\n        ? \"0\" + (date.getMonth() + 1)\r\n        : date.getMonth() + 1;\r\n    let dateLabelYear = date.getFullYear();\r\n    let dateLabel = dateLabelDate + \"/\" + dateLabelMonth + \"/\" + dateLabelYear;\r\n    return dateLabel;\r\n  }\r\n\r\n  function getPhoto() {\r\n    if (my_uid != messages[0].message_user_uid) {\r\n      pphoto = messages[0].pphoto;\r\n      name = messages[0].name;\r\n    }\r\n    if (pphoto == \"\") {\r\n      return (\r\n        <span className=\"avatar-title bg-info rounded-circle\">\r\n          {name.substring(0, 1)}\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <img\r\n          src={\"pphotoChat/\" + name}\r\n          className=\"rounded-circle\"\r\n          alt=\"image\"\r\n        />\r\n      );\r\n    }\r\n  }\r\n  let dateSend = new Date(messages[0].length > 0 ? messages[0].time : messages);\r\n\r\n  let yesterday = new Date();\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  let yesterdayLabel = getDateLabel(yesterday);\r\n  let todayLabel = getDateLabel(new Date());\r\n\r\n  function getTodayLabel(dateLabel) {\r\n    if (dateLabel == yesterdayLabel) {\r\n      dateLabel = \"Ayer\";\r\n    } else if (dateLabel == todayLabel) {\r\n      dateLabel = \"Hoy\";\r\n    }\r\n\r\n    if (actualLabelDate == dateLabel) {\r\n      return \"\";\r\n    } else {\r\n      actualLabelDate = dateLabel;\r\n      return (\r\n        <div\r\n          className=\"message-item messages-divider sticky-top\"\r\n          data-label={actualLabelDate}\r\n        ></div>\r\n      );\r\n    }\r\n  }\r\n\r\n  function SendMessage(event) {\r\n    event.preventDefault();\r\n\r\n    const socket = socketIOClient(ENDPOINT);\r\n    if (newMessage.length > 0) {\r\n      socket.emit(\"chat message\", { chat: chat_uid, message: newMessage });\r\n      socket.emit(\"get chats\");\r\n      socket.emit(\"get messages\", { id: chat_uid, page: props.currentPage });\r\n      setnewMessage(\"\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"chat-header\">\r\n        <div className=\"chat-header-user\">{getPhoto()}</div>\r\n        <div className=\"chat-header-action\">\r\n          <ul className=\"list-inline\">\r\n            <li className=\"list-inline-item d-xl-none d-inline\">\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light mobile-navigation-button\"\r\n              >\r\n                {/* <i className=\"ti-more\" /> */}\r\n                <i className=\"fal fa-ellipsis-h-alt\"></i>\r\n              </a>\r\n            </li>\r\n            <li\r\n              className=\"list-inline-item\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Voice call\"\r\n            >\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light text-success\"\r\n                data-toggle=\"modal\"\r\n                data-target=\"#call\"\r\n              >\r\n                {/* <i className=\"ti-mobile\" /> */}\r\n                <i className=\"fas fa-phone\"></i>\r\n              </a>\r\n            </li>\r\n            <li\r\n              className=\"list-inline-item\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Video call\"\r\n            >\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light text-warning\"\r\n                data-toggle=\"modal\"\r\n                data-target=\"#videoCall\"\r\n              >\r\n                {/* <i className=\"ti-video-camera\" /> */}\r\n                <i className=\"fas fa-video\"></i>\r\n              </a>\r\n            </li>\r\n            <li className=\"list-inline-item\">\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light\"\r\n                data-toggle=\"dropdown\"\r\n              >\r\n                <i className=\"ti-more\" />\r\n              </a>\r\n              <div className=\"dropdown-menu dropdown-menu-right\">\r\n                <a\r\n                  href=\"#\"\r\n                  data-navigation-target=\"contact-information\"\r\n                  className=\"dropdown-item\"\r\n                >\r\n                  Profile\r\n                </a>\r\n                <a href=\"#\" className=\"dropdown-item\">\r\n                  Add to archive\r\n                </a>\r\n                <a href=\"#\" className=\"dropdown-item\">\r\n                  Delete\r\n                </a>\r\n                <div className=\"dropdown-divider\" />\r\n                <a href=\"#\" className=\"dropdown-item text-danger\">\r\n                  Block\r\n                </a>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <div className=\"chat-body\">\r\n        <div className=\"messages\">\r\n          {messages.map((message, index) => {\r\n            message_user_uid = message.message_user_uid;\r\n\r\n            dateSend = new Date(message.time);\r\n            let timeSend = timeformat(dateSend);\r\n            let out = my_uid == message_user_uid ? \"outgoing-message\" : \"\";\r\n            let ticks =\r\n              my_uid == message_user_uid ? <i className=\"ti-check\"></i> : \"\"; // double checked\r\n            let usrname =\r\n              message.chat_type == 1 && my_uid != message_user_uid\r\n                ? message.name\r\n                : \"\";\r\n\r\n            return (\r\n              <div className=\"messages-container\" key={index + 1}>\r\n                {getTodayLabel(getDateLabel(dateSend))}\r\n                <div className={\"message-item \" + out}>\r\n                  {usrname}\r\n                  <div className=\"message-content\">\r\n                    {message.message}\r\n                    {/* <a\r\n                      href=\"#\"\r\n                      className=\"btn btn-outline-light\"\r\n                      data-toggle=\"dropdown\"\r\n                    >\r\n                      <i class=\"fas fa-ellipsis-h\"></i>\r\n                    </a>\r\n                    <div className=\"dropdown-menu dropdown-menu-right\">\r\n                      <a\r\n                        href=\"#\"\r\n                        className=\"dropdown-item\"\r\n                        onClick=\"DeleteChat('a4bbbc58-97ea-46a9-8065-6a3194b9527b')\"\r\n                      >\r\n                        Delete\r\n                      </a>\r\n                    </div> */}\r\n                    <div class=\"btn action-toggle\">\r\n                      <div class=\"dropdown\">\r\n                        <a\r\n                          className=\"text-light\"\r\n                          data-toggle=\"dropdown\"\r\n                          href=\"#\"\r\n                        >\r\n                          <i class=\"fas fa-ellipsis-h\"></i>\r\n                        </a>\r\n                        <div class=\"dropdown-menu dropdown-menu-left\">\r\n                          <a href=\"#\" class=\"dropdown-item\">\r\n                            Delete\r\n                          </a>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"message-avatar\">\r\n                      <div>\r\n                        <div className=\"time\">\r\n                          {timeSend} {ticks}\r\n                          <i className=\"ti-check\"></i>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n      <div className=\"chat-footer\">\r\n        <form onSubmit={(event) => SendMessage(event, newMessage, chat_uid)}>\r\n          <div>\r\n            <button\r\n              className=\"btn btn-light mr-3\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Emoji\"\r\n              type=\"button\"\r\n            >\r\n              <i className=\"ti-face-smile\" />\r\n            </button>\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            placeholder=\"Write a message.\"\r\n            value={newMessage}\r\n            onChange={(e) => setnewMessage(e.target.value)}\r\n          />\r\n          <div className=\"form-buttons\">\r\n            <button\r\n              className=\"btn btn-light\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Add files\"\r\n              type=\"button\"\r\n            >\r\n              {/* <i className=\"ti-clip\" /> */}\r\n              <i className=\"fas fa-paperclip\"></i>\r\n            </button>\r\n            <button\r\n              className=\"btn btn-light d-sm-none d-block\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Send a voice record\"\r\n              type=\"button\"\r\n            >\r\n              <i data-feather=\"mic\" />\r\n            </button>\r\n            <button className=\"btn btn-primary\" type=\"submit\">\r\n              {/* <i className=\"ti-location-arrow\" /> */}\r\n              <i className=\"fas fa-paper-plane\"></i>\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatBodyMessage;\r\n"]},"metadata":{},"sourceType":"module"}