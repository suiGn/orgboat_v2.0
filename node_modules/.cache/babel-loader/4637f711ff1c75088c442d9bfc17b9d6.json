{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\kgrob\\\\Documents\\\\Proyectos de programaci\\xF3n\\\\OrgBoat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import socketIOClient from\"socket.io-client\";import{Menu,Phone,Video,MoreHorizontal,Paperclip,Send,Smile,Mic,ChevronDown,Check}from\"react-feather\";var ENDPOINT=\"http://localhost:5000\";function ChatBodyMessage(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),newMessage=_useState2[0],setnewMessage=_useState2[1];var messages=[].concat(props.messages).reverse();var actualLabelDate=\"\";var message_user_uid;var pphoto=my_uid!=messages[0].message_user_uid?pphoto=messages[0].pphoto:\"\";var name=my_uid!=messages[0].message_user_uid?messages[0].name:\"\";var p;var chat_uid=props.clicked.chat_uid;var my_uid=props.my_uid;function timeformat(date){var h=date.getHours();var m=date.getMinutes();var x=h>=12?\"PM\":\"AM\";h=h%12;h=h?h:12;m=m<10?\"0\"+m:m;var mytime=h+\":\"+m+\" \"+x;return mytime;}function getDateLabel(date){var dateLabelDate=date.getDate()<10?\"0\"+date.getDate():date.getDate();var dateLabelMonth=date.getMonth()+1<10?\"0\"+(date.getMonth()+1):date.getMonth()+1;var dateLabelYear=date.getFullYear();var dateLabel=dateLabelDate+\"/\"+dateLabelMonth+\"/\"+dateLabelYear;return dateLabel;}console.log(\"chat uid\",clicked);function getPhoto(){if(my_uid!=messages[0].message_user_uid){pphoto=messages[0].pphoto;name=messages[0].name;}if(pphoto==\"\"){return/*#__PURE__*/React.createElement(\"figure\",{className:\"avatar\"},/*#__PURE__*/React.createElement(\"span\",{className:\"avatar-title bg-info rounded-circle\"},name.substring(0,1)));}else{return/*#__PURE__*/React.createElement(\"figure\",null,/*#__PURE__*/React.createElement(\"img\",{src:pphoto,className:\"rounded-circle\",alt:\"image\"}));}}var dateSend=new Date(messages[0].time);var yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);var yesterdayLabel=getDateLabel(yesterday);var todayLabel=getDateLabel(new Date());function getTodayLabel(dateLabel){if(dateLabel==yesterdayLabel){dateLabel=\"Ayer\";}else if(dateLabel==todayLabel){dateLabel=\"Hoy\";}if(actualLabelDate==dateLabel){return\"\";}else{actualLabelDate=dateLabel;return/*#__PURE__*/React.createElement(\"div\",{className:\"message-item messages-divider sticky-top\",\"data-label\":actualLabelDate});}}function SendMessage(event){event.preventDefault();var socket=socketIOClient(ENDPOINT);if(newMessage.length>0){socket.emit(\"chat message\",{chat:chat_uid,message:newMessage});socket.emit(\"get chats\");socket.emit(\"get messages\",{id:chat_uid,page:props.currentPage});setnewMessage(\"\");}}function DeleteMessage(message){var socket=socketIOClient(ENDPOINT);socket.emit(\"Delete message\",{message:message});socket.on(\"retriveDeleteMessage\",function(){//socket.emit(\"get chats\");\nsocket.emit(\"get messages\",{id:chat_uid,page:props.currentPage});setnewMessage(\"\");});}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header-user\"},getPhoto(),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h5\",{id:\"chat-name\"},name,\" \"))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-header-action\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"list-inline\"},/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item d-xl-none d-inline\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light mobile-navigation-button\"},/*#__PURE__*/React.createElement(Menu,null))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\",\"data-toggle\":\"tooltip\",title:\"Voice call\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light text-success\",\"data-toggle\":\"modal\",\"data-target\":\"#call\"},/*#__PURE__*/React.createElement(Phone,null))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\",\"data-toggle\":\"tooltip\",title:\"Video call\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light text-warning\",\"data-toggle\":\"modal\",\"data-target\":\"#videoCall\"},/*#__PURE__*/React.createElement(Video,null))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"btn btn-outline-light\",\"data-toggle\":\"dropdown\"},/*#__PURE__*/React.createElement(MoreHorizontal,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-menu dropdown-menu-right\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",\"data-navigation-target\":\"contact-information\",className:\"dropdown-item\"},\"Profile\"),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item\"},\"Add to archive\"),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item\"},\"Delete\"),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-divider\"}),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"dropdown-item text-danger\"},\"Block\")))))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"messages\"},messages.map(function(message,index){message_user_uid=message.message_user_uid||message.from;dateSend=new Date(message.time);var timeSend=timeformat(dateSend);var out=my_uid==message_user_uid?\"outgoing-message\":\"\";var ticks=my_uid==message_user_uid?/*#__PURE__*/React.createElement(Check,null):\"\";// double checked\nvar usrname=message.chat_type==1&&my_uid!=message_user_uid?message.name:\"\";return/*#__PURE__*/React.createElement(\"div\",{className:\"messages-container\",key:index+1},getTodayLabel(getDateLabel(dateSend)),/*#__PURE__*/React.createElement(\"div\",{className:\"message-item \"+out},usrname,/*#__PURE__*/React.createElement(\"div\",{className:\"message-content relative\"},message.message,/*#__PURE__*/React.createElement(\"div\",{class:\"btn action-toggle action-dropdown-chat\"},/*#__PURE__*/React.createElement(\"div\",{class:\"dropdown dropdown-chat-message\"},/*#__PURE__*/React.createElement(\"a\",{className:\"text-light\",\"data-toggle\":\"dropdown\",href:\"#\"},/*#__PURE__*/React.createElement(ChevronDown,null)),/*#__PURE__*/React.createElement(\"div\",{class:\"dropdown-menu dropdown-menu-left\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",class:\"dropdown-item\",onClick:function onClick(){return DeleteMessage(message);}},\"Delete\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-avatar flex-end relative custom-time-holder\"},/*#__PURE__*/React.createElement(\"div\",{className:\"custom-time\"},/*#__PURE__*/React.createElement(\"div\",{className:\"time\"},timeSend,\" \",ticks))))));}))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat-footer\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(event){return SendMessage(event,newMessage,chat_uid);}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light mr-3\",\"data-toggle\":\"tooltip\",title:\"Emoji\",type:\"button\"},/*#__PURE__*/React.createElement(Smile,null))),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",placeholder:\"Write a message.\",value:newMessage,onChange:function onChange(e){return setnewMessage(e.target.value);}}),/*#__PURE__*/React.createElement(\"div\",{className:\"form-buttons\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light\",\"data-toggle\":\"tooltip\",title:\"Add files\",type:\"button\"},/*#__PURE__*/React.createElement(Paperclip,null)),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light d-sm-none d-block\",\"data-toggle\":\"tooltip\",title:\"Send a voice record\",type:\"button\"},/*#__PURE__*/React.createElement(Mic,null)),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\",type:\"submit\"},/*#__PURE__*/React.createElement(Send,null))))));}export default ChatBodyMessage;","map":{"version":3,"sources":["C:/Users/kgrob/Documents/Proyectos de programaci√≥n/OrgBoat/src/components/ChatBodyMessage.js"],"names":["React","useState","socketIOClient","Menu","Phone","Video","MoreHorizontal","Paperclip","Send","Smile","Mic","ChevronDown","Check","ENDPOINT","ChatBodyMessage","props","newMessage","setnewMessage","messages","concat","reverse","actualLabelDate","message_user_uid","pphoto","my_uid","name","p","chat_uid","clicked","timeformat","date","h","getHours","m","getMinutes","x","mytime","getDateLabel","dateLabelDate","getDate","dateLabelMonth","getMonth","dateLabelYear","getFullYear","dateLabel","console","log","getPhoto","substring","dateSend","Date","time","yesterday","setDate","yesterdayLabel","todayLabel","getTodayLabel","SendMessage","event","preventDefault","socket","length","emit","chat","message","id","page","currentPage","DeleteMessage","on","map","index","from","timeSend","out","ticks","usrname","chat_type","e","target","value"],"mappings":"8LAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,OACEC,IADF,CAEEC,KAFF,CAGEC,KAHF,CAIEC,cAJF,CAKEC,SALF,CAMEC,IANF,CAOEC,KAPF,CAQEC,GARF,CASEC,WATF,CAUEC,KAVF,KAWO,eAXP,CAYA,GAAMC,CAAAA,QAAQ,CAAG,uBAAjB,CAEA,QAASC,CAAAA,eAAT,CAAyBC,KAAzB,CAAgC,eACMd,QAAQ,CAAC,EAAD,CADd,wCACvBe,UADuB,eACXC,aADW,eAE9B,GAAIC,CAAAA,QAAQ,CAAG,GAAGC,MAAH,CAAUJ,KAAK,CAACG,QAAhB,EAA0BE,OAA1B,EAAf,CAEA,GAAIC,CAAAA,eAAe,CAAG,EAAtB,CACA,GAAIC,CAAAA,gBAAJ,CACA,GAAIC,CAAAA,MAAM,CACRC,MAAM,EAAIN,QAAQ,CAAC,CAAD,CAAR,CAAYI,gBAAtB,CAA0CC,MAAM,CAAGL,QAAQ,CAAC,CAAD,CAAR,CAAYK,MAA/D,CAAyE,EAD3E,CAEA,GAAIE,CAAAA,IAAI,CAAGD,MAAM,EAAIN,QAAQ,CAAC,CAAD,CAAR,CAAYI,gBAAtB,CAAyCJ,QAAQ,CAAC,CAAD,CAAR,CAAYO,IAArD,CAA4D,EAAvE,CACA,GAAIC,CAAAA,CAAJ,CACA,GAAIC,CAAAA,QAAQ,CAAGZ,KAAK,CAACa,OAAN,CAAcD,QAA7B,CACA,GAAIH,CAAAA,MAAM,CAAGT,KAAK,CAACS,MAAnB,CAEA,QAASK,CAAAA,UAAT,CAAoBC,IAApB,CAA0B,CACxB,GAAIC,CAAAA,CAAC,CAAGD,IAAI,CAACE,QAAL,EAAR,CACA,GAAIC,CAAAA,CAAC,CAAGH,IAAI,CAACI,UAAL,EAAR,CACA,GAAIC,CAAAA,CAAC,CAAGJ,CAAC,EAAI,EAAL,CAAU,IAAV,CAAiB,IAAzB,CACAA,CAAC,CAAGA,CAAC,CAAG,EAAR,CACAA,CAAC,CAAGA,CAAC,CAAGA,CAAH,CAAO,EAAZ,CACAE,CAAC,CAAGA,CAAC,CAAG,EAAJ,CAAS,IAAMA,CAAf,CAAmBA,CAAvB,CACA,GAAIG,CAAAA,MAAM,CAAGL,CAAC,CAAG,GAAJ,CAAUE,CAAV,CAAc,GAAd,CAAoBE,CAAjC,CACA,MAAOC,CAAAA,MAAP,CACD,CAED,QAASC,CAAAA,YAAT,CAAsBP,IAAtB,CAA4B,CAC1B,GAAIQ,CAAAA,aAAa,CACfR,IAAI,CAACS,OAAL,GAAiB,EAAjB,CAAsB,IAAMT,IAAI,CAACS,OAAL,EAA5B,CAA6CT,IAAI,CAACS,OAAL,EAD/C,CAEA,GAAIC,CAAAA,cAAc,CAChBV,IAAI,CAACW,QAAL,GAAkB,CAAlB,CAAsB,EAAtB,CACI,KAAOX,IAAI,CAACW,QAAL,GAAkB,CAAzB,CADJ,CAEIX,IAAI,CAACW,QAAL,GAAkB,CAHxB,CAIA,GAAIC,CAAAA,aAAa,CAAGZ,IAAI,CAACa,WAAL,EAApB,CACA,GAAIC,CAAAA,SAAS,CAAGN,aAAa,CAAG,GAAhB,CAAsBE,cAAtB,CAAuC,GAAvC,CAA6CE,aAA7D,CACA,MAAOE,CAAAA,SAAP,CACD,CAEDC,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAwBlB,OAAxB,EAEA,QAASmB,CAAAA,QAAT,EAAoB,CAClB,GAAIvB,MAAM,EAAIN,QAAQ,CAAC,CAAD,CAAR,CAAYI,gBAA1B,CAA4C,CAC1CC,MAAM,CAAGL,QAAQ,CAAC,CAAD,CAAR,CAAYK,MAArB,CACAE,IAAI,CAAGP,QAAQ,CAAC,CAAD,CAAR,CAAYO,IAAnB,CACD,CACD,GAAIF,MAAM,EAAI,EAAd,CAAkB,CAChB,mBACE,8BAAQ,SAAS,CAAC,QAAlB,eACE,4BAAM,SAAS,CAAC,qCAAhB,EACGE,IAAI,CAACuB,SAAL,CAAe,CAAf,CAAkB,CAAlB,CADH,CADF,CADF,CAOD,CARD,IAQO,CACL,mBACE,+CACE,2BAAK,GAAG,CAAEzB,MAAV,CAAkB,SAAS,CAAC,gBAA5B,CAA6C,GAAG,CAAC,OAAjD,EADF,CADF,CAKD,CACF,CAED,GAAI0B,CAAAA,QAAQ,CAAG,GAAIC,CAAAA,IAAJ,CAAShC,QAAQ,CAAC,CAAD,CAAR,CAAYiC,IAArB,CAAf,CAEA,GAAIC,CAAAA,SAAS,CAAG,GAAIF,CAAAA,IAAJ,EAAhB,CACAE,SAAS,CAACC,OAAV,CAAkBD,SAAS,CAACb,OAAV,GAAsB,CAAxC,EACA,GAAIe,CAAAA,cAAc,CAAGjB,YAAY,CAACe,SAAD,CAAjC,CACA,GAAIG,CAAAA,UAAU,CAAGlB,YAAY,CAAC,GAAIa,CAAAA,IAAJ,EAAD,CAA7B,CAEA,QAASM,CAAAA,aAAT,CAAuBZ,SAAvB,CAAkC,CAChC,GAAIA,SAAS,EAAIU,cAAjB,CAAiC,CAC/BV,SAAS,CAAG,MAAZ,CACD,CAFD,IAEO,IAAIA,SAAS,EAAIW,UAAjB,CAA6B,CAClCX,SAAS,CAAG,KAAZ,CACD,CAED,GAAIvB,eAAe,EAAIuB,SAAvB,CAAkC,CAChC,MAAO,EAAP,CACD,CAFD,IAEO,CACLvB,eAAe,CAAGuB,SAAlB,CACA,mBACE,2BACE,SAAS,CAAC,0CADZ,CAEE,aAAYvB,eAFd,EADF,CAMD,CACF,CAED,QAASoC,CAAAA,WAAT,CAAqBC,KAArB,CAA4B,CAC1BA,KAAK,CAACC,cAAN,GAEA,GAAMC,CAAAA,MAAM,CAAG1D,cAAc,CAACW,QAAD,CAA7B,CACA,GAAIG,UAAU,CAAC6C,MAAX,CAAoB,CAAxB,CAA2B,CACzBD,MAAM,CAACE,IAAP,CAAY,cAAZ,CAA4B,CAAEC,IAAI,CAAEpC,QAAR,CAAkBqC,OAAO,CAAEhD,UAA3B,CAA5B,EACA4C,MAAM,CAACE,IAAP,CAAY,WAAZ,EACAF,MAAM,CAACE,IAAP,CAAY,cAAZ,CAA4B,CAAEG,EAAE,CAAEtC,QAAN,CAAgBuC,IAAI,CAAEnD,KAAK,CAACoD,WAA5B,CAA5B,EACAlD,aAAa,CAAC,EAAD,CAAb,CACD,CACF,CACD,QAASmD,CAAAA,aAAT,CAAuBJ,OAAvB,CAAgC,CAC9B,GAAMJ,CAAAA,MAAM,CAAG1D,cAAc,CAACW,QAAD,CAA7B,CACA+C,MAAM,CAACE,IAAP,CAAY,gBAAZ,CAA8B,CAAEE,OAAO,CAAEA,OAAX,CAA9B,EACAJ,MAAM,CAACS,EAAP,CAAU,sBAAV,CAAkC,UAAM,CACtC;AACAT,MAAM,CAACE,IAAP,CAAY,cAAZ,CAA4B,CAAEG,EAAE,CAAEtC,QAAN,CAAgBuC,IAAI,CAAEnD,KAAK,CAACoD,WAA5B,CAA5B,EACAlD,aAAa,CAAC,EAAD,CAAb,CACD,CAJD,EAKD,CAED,mBACE,4CACE,2BAAK,SAAS,CAAC,aAAf,eACE,2BAAK,SAAS,CAAC,kBAAf,EACG8B,QAAQ,EADX,cAEE,4CACE,0BAAI,EAAE,CAAC,WAAP,EAAoBtB,IAApB,KADF,CAFF,CADF,cAQE,2BAAK,SAAS,CAAC,oBAAf,eACE,0BAAI,SAAS,CAAC,aAAd,eACE,0BAAI,SAAS,CAAC,qCAAd,eACE,yBACE,IAAI,CAAC,GADP,CAEE,SAAS,CAAC,gDAFZ,eAIE,oBAAC,IAAD,MAJF,CADF,CADF,cASE,0BACE,SAAS,CAAC,kBADZ,CAEE,cAAY,SAFd,CAGE,KAAK,CAAC,YAHR,eAKE,yBACE,IAAI,CAAC,GADP,CAEE,SAAS,CAAC,oCAFZ,CAGE,cAAY,OAHd,CAIE,cAAY,OAJd,eAME,oBAAC,KAAD,MANF,CALF,CATF,cAuBE,0BACE,SAAS,CAAC,kBADZ,CAEE,cAAY,SAFd,CAGE,KAAK,CAAC,YAHR,eAKE,yBACE,IAAI,CAAC,GADP,CAEE,SAAS,CAAC,oCAFZ,CAGE,cAAY,OAHd,CAIE,cAAY,YAJd,eAME,oBAAC,KAAD,MANF,CALF,CAvBF,cAqCE,0BAAI,SAAS,CAAC,kBAAd,eACE,yBACE,IAAI,CAAC,GADP,CAEE,SAAS,CAAC,uBAFZ,CAGE,cAAY,UAHd,eAKE,oBAAC,cAAD,MALF,CADF,cAQE,2BAAK,SAAS,CAAC,mCAAf,eACE,yBACE,IAAI,CAAC,GADP,CAEE,yBAAuB,qBAFzB,CAGE,SAAS,CAAC,eAHZ,YADF,cAQE,yBAAG,IAAI,CAAC,GAAR,CAAY,SAAS,CAAC,eAAtB,mBARF,cAWE,yBAAG,IAAI,CAAC,GAAR,CAAY,SAAS,CAAC,eAAtB,WAXF,cAcE,2BAAK,SAAS,CAAC,kBAAf,EAdF,cAeE,yBAAG,IAAI,CAAC,GAAR,CAAY,SAAS,CAAC,2BAAtB,UAfF,CARF,CArCF,CADF,CARF,CADF,cA8EE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,UAAf,EACGP,QAAQ,CAACoD,GAAT,CAAa,SAACN,OAAD,CAAUO,KAAV,CAAoB,CAChCjD,gBAAgB,CAAG0C,OAAO,CAAC1C,gBAAR,EAA4B0C,OAAO,CAACQ,IAAvD,CACAvB,QAAQ,CAAG,GAAIC,CAAAA,IAAJ,CAASc,OAAO,CAACb,IAAjB,CAAX,CACA,GAAIsB,CAAAA,QAAQ,CAAG5C,UAAU,CAACoB,QAAD,CAAzB,CACA,GAAIyB,CAAAA,GAAG,CAAGlD,MAAM,EAAIF,gBAAV,CAA6B,kBAA7B,CAAkD,EAA5D,CACA,GAAIqD,CAAAA,KAAK,CAAGnD,MAAM,EAAIF,gBAAV,cAA6B,oBAAC,KAAD,MAA7B,CAAyC,EAArD,CAAyD;AACzD,GAAIsD,CAAAA,OAAO,CACTZ,OAAO,CAACa,SAAR,EAAqB,CAArB,EAA0BrD,MAAM,EAAIF,gBAApC,CACI0C,OAAO,CAACvC,IADZ,CAEI,EAHN,CAIA,mBACE,2BAAK,SAAS,CAAC,oBAAf,CAAoC,GAAG,CAAE8C,KAAK,CAAG,CAAjD,EACGf,aAAa,CAACnB,YAAY,CAACY,QAAD,CAAb,CADhB,cAEE,2BAAK,SAAS,CAAE,gBAAkByB,GAAlC,EACGE,OADH,cAEE,2BAAK,SAAS,CAAC,0BAAf,EACGZ,OAAO,CAACA,OADX,cAkBE,2BAAK,KAAK,CAAC,wCAAX,eACE,2BAAK,KAAK,CAAC,gCAAX,eACE,yBACE,SAAS,CAAC,YADZ,CAEE,cAAY,UAFd,CAGE,IAAI,CAAC,GAHP,eAKE,oBAAC,WAAD,MALF,CADF,cAQE,2BAAK,KAAK,CAAC,kCAAX,eACE,yBACE,IAAI,CAAC,GADP,CAEE,KAAK,CAAC,eAFR,CAGE,OAAO,CAAE,yBAAMI,CAAAA,aAAa,CAACJ,OAAD,CAAnB,EAHX,WADF,CARF,CADF,CAlBF,cAsCE,2BAAK,SAAS,CAAC,qDAAf,eACE,2BAAK,SAAS,CAAC,aAAf,eACE,2BAAK,SAAS,CAAC,MAAf,EACGS,QADH,KACcE,KADd,CADF,CADF,CAtCF,CAFF,CAFF,CADF,CAuDD,CAjEA,CADH,CADF,CA9EF,cAoJE,2BAAK,SAAS,CAAC,aAAf,eACE,4BAAM,QAAQ,CAAE,kBAACjB,KAAD,QAAWD,CAAAA,WAAW,CAACC,KAAD,CAAQ1C,UAAR,CAAoBW,QAApB,CAAtB,EAAhB,eACE,4CACE,8BACE,SAAS,CAAC,oBADZ,CAEE,cAAY,SAFd,CAGE,KAAK,CAAC,OAHR,CAIE,IAAI,CAAC,QAJP,eAME,oBAAC,KAAD,MANF,CADF,CADF,cAWE,6BACE,IAAI,CAAC,MADP,CAEE,SAAS,CAAC,cAFZ,CAGE,WAAW,CAAC,kBAHd,CAIE,KAAK,CAAEX,UAJT,CAKE,QAAQ,CAAE,kBAAC8D,CAAD,QAAO7D,CAAAA,aAAa,CAAC6D,CAAC,CAACC,MAAF,CAASC,KAAV,CAApB,EALZ,EAXF,cAkBE,2BAAK,SAAS,CAAC,cAAf,eACE,8BACE,SAAS,CAAC,eADZ,CAEE,cAAY,SAFd,CAGE,KAAK,CAAC,WAHR,CAIE,IAAI,CAAC,QAJP,eAME,oBAAC,SAAD,MANF,CADF,cASE,8BACE,SAAS,CAAC,iCADZ,CAEE,cAAY,SAFd,CAGE,KAAK,CAAC,qBAHR,CAIE,IAAI,CAAC,QAJP,eAME,oBAAC,GAAD,MANF,CATF,cAiBE,8BAAQ,SAAS,CAAC,iBAAlB,CAAoC,IAAI,CAAC,QAAzC,eACE,oBAAC,IAAD,MADF,CAjBF,CAlBF,CADF,CApJF,CADF,CAiMD,CAED,cAAelE,CAAAA,eAAf","sourcesContent":["import React, { useState } from \"react\";\r\nimport socketIOClient from \"socket.io-client\";\r\nimport {\r\n  Menu,\r\n  Phone,\r\n  Video,\r\n  MoreHorizontal,\r\n  Paperclip,\r\n  Send,\r\n  Smile,\r\n  Mic,\r\n  ChevronDown,\r\n  Check,\r\n} from \"react-feather\";\r\nconst ENDPOINT = \"http://localhost:5000\";\r\n\r\nfunction ChatBodyMessage(props) {\r\n  const [newMessage, setnewMessage] = useState([]);\r\n  let messages = [].concat(props.messages).reverse();\r\n\r\n  let actualLabelDate = \"\";\r\n  let message_user_uid;\r\n  let pphoto =\r\n    my_uid != messages[0].message_user_uid ? (pphoto = messages[0].pphoto) : \"\";\r\n  let name = my_uid != messages[0].message_user_uid ? messages[0].name : \"\";\r\n  let p;\r\n  let chat_uid = props.clicked.chat_uid;\r\n  let my_uid = props.my_uid;\r\n\r\n  function timeformat(date) {\r\n    var h = date.getHours();\r\n    var m = date.getMinutes();\r\n    var x = h >= 12 ? \"PM\" : \"AM\";\r\n    h = h % 12;\r\n    h = h ? h : 12;\r\n    m = m < 10 ? \"0\" + m : m;\r\n    var mytime = h + \":\" + m + \" \" + x;\r\n    return mytime;\r\n  }\r\n\r\n  function getDateLabel(date) {\r\n    let dateLabelDate =\r\n      date.getDate() < 10 ? \"0\" + date.getDate() : date.getDate();\r\n    let dateLabelMonth =\r\n      date.getMonth() + 1 < 10\r\n        ? \"0\" + (date.getMonth() + 1)\r\n        : date.getMonth() + 1;\r\n    let dateLabelYear = date.getFullYear();\r\n    let dateLabel = dateLabelDate + \"/\" + dateLabelMonth + \"/\" + dateLabelYear;\r\n    return dateLabel;\r\n  }\r\n\r\n  console.log(\"chat uid\", clicked);\r\n\r\n  function getPhoto() {\r\n    if (my_uid != messages[0].message_user_uid) {\r\n      pphoto = messages[0].pphoto;\r\n      name = messages[0].name;\r\n    }\r\n    if (pphoto == \"\") {\r\n      return (\r\n        <figure className=\"avatar\">\r\n          <span className=\"avatar-title bg-info rounded-circle\">\r\n            {name.substring(0, 1)}\r\n          </span>\r\n        </figure>\r\n      );\r\n    } else {\r\n      return (\r\n        <figure>\r\n          <img src={pphoto} className=\"rounded-circle\" alt=\"image\" />\r\n        </figure>\r\n      );\r\n    }\r\n  }\r\n\r\n  let dateSend = new Date(messages[0].time);\r\n\r\n  let yesterday = new Date();\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  let yesterdayLabel = getDateLabel(yesterday);\r\n  let todayLabel = getDateLabel(new Date());\r\n\r\n  function getTodayLabel(dateLabel) {\r\n    if (dateLabel == yesterdayLabel) {\r\n      dateLabel = \"Ayer\";\r\n    } else if (dateLabel == todayLabel) {\r\n      dateLabel = \"Hoy\";\r\n    }\r\n\r\n    if (actualLabelDate == dateLabel) {\r\n      return \"\";\r\n    } else {\r\n      actualLabelDate = dateLabel;\r\n      return (\r\n        <div\r\n          className=\"message-item messages-divider sticky-top\"\r\n          data-label={actualLabelDate}\r\n        ></div>\r\n      );\r\n    }\r\n  }\r\n\r\n  function SendMessage(event) {\r\n    event.preventDefault();\r\n\r\n    const socket = socketIOClient(ENDPOINT);\r\n    if (newMessage.length > 0) {\r\n      socket.emit(\"chat message\", { chat: chat_uid, message: newMessage });\r\n      socket.emit(\"get chats\");\r\n      socket.emit(\"get messages\", { id: chat_uid, page: props.currentPage });\r\n      setnewMessage(\"\");\r\n    }\r\n  }\r\n  function DeleteMessage(message) {\r\n    const socket = socketIOClient(ENDPOINT);\r\n    socket.emit(\"Delete message\", { message: message });\r\n    socket.on(\"retriveDeleteMessage\", () => {\r\n      //socket.emit(\"get chats\");\r\n      socket.emit(\"get messages\", { id: chat_uid, page: props.currentPage });\r\n      setnewMessage(\"\");\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"chat-header\">\r\n        <div className=\"chat-header-user\">\r\n          {getPhoto()}\r\n          <div>\r\n            <h5 id=\"chat-name\">{name} </h5>\r\n            {/* <small className=\"text-success\">{\" <i>writing...</i>\"}</small> */}\r\n          </div>\r\n        </div>\r\n        <div className=\"chat-header-action\">\r\n          <ul className=\"list-inline\">\r\n            <li className=\"list-inline-item d-xl-none d-inline\">\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light mobile-navigation-button\"\r\n              >\r\n                <Menu />\r\n              </a>\r\n            </li>\r\n            <li\r\n              className=\"list-inline-item\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Voice call\"\r\n            >\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light text-success\"\r\n                data-toggle=\"modal\"\r\n                data-target=\"#call\"\r\n              >\r\n                <Phone />\r\n              </a>\r\n            </li>\r\n            <li\r\n              className=\"list-inline-item\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Video call\"\r\n            >\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light text-warning\"\r\n                data-toggle=\"modal\"\r\n                data-target=\"#videoCall\"\r\n              >\r\n                <Video />\r\n              </a>\r\n            </li>\r\n            <li className=\"list-inline-item\">\r\n              <a\r\n                href=\"#\"\r\n                className=\"btn btn-outline-light\"\r\n                data-toggle=\"dropdown\"\r\n              >\r\n                <MoreHorizontal />\r\n              </a>\r\n              <div className=\"dropdown-menu dropdown-menu-right\">\r\n                <a\r\n                  href=\"#\"\r\n                  data-navigation-target=\"contact-information\"\r\n                  className=\"dropdown-item\"\r\n                >\r\n                  Profile\r\n                </a>\r\n                <a href=\"#\" className=\"dropdown-item\">\r\n                  Add to archive\r\n                </a>\r\n                <a href=\"#\" className=\"dropdown-item\">\r\n                  Delete\r\n                </a>\r\n                <div className=\"dropdown-divider\" />\r\n                <a href=\"#\" className=\"dropdown-item text-danger\">\r\n                  Block\r\n                </a>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <div className=\"chat-body\">\r\n        <div className=\"messages\">\r\n          {messages.map((message, index) => {\r\n            message_user_uid = message.message_user_uid || message.from;\r\n            dateSend = new Date(message.time);\r\n            let timeSend = timeformat(dateSend);\r\n            let out = my_uid == message_user_uid ? \"outgoing-message\" : \"\";\r\n            let ticks = my_uid == message_user_uid ? <Check /> : \"\"; // double checked\r\n            let usrname =\r\n              message.chat_type == 1 && my_uid != message_user_uid\r\n                ? message.name\r\n                : \"\";\r\n            return (\r\n              <div className=\"messages-container\" key={index + 1}>\r\n                {getTodayLabel(getDateLabel(dateSend))}\r\n                <div className={\"message-item \" + out}>\r\n                  {usrname}\r\n                  <div className=\"message-content relative\">\r\n                    {message.message}\r\n                    {/* <a\r\n                      href=\"#\"\r\n                      className=\"btn btn-outline-light\"\r\n                      data-toggle=\"dropdown\"\r\n                    >\r\n                      <i class=\"fas fa-ellipsis-h\"></i>\r\n                    </a>\r\n                    <div className=\"dropdown-menu dropdown-menu-right\">\r\n                      <a\r\n                        href=\"#\"\r\n                        className=\"dropdown-item\"\r\n                        onClick={() => DeleteMessage(message)}\r\n                      >\r\n                        Delete\r\n                      </a>\r\n                    </div> */}\r\n                    <div class=\"btn action-toggle action-dropdown-chat\">\r\n                      <div class=\"dropdown dropdown-chat-message\">\r\n                        <a\r\n                          className=\"text-light\"\r\n                          data-toggle=\"dropdown\"\r\n                          href=\"#\"\r\n                        >\r\n                          <ChevronDown />\r\n                        </a>\r\n                        <div class=\"dropdown-menu dropdown-menu-left\">\r\n                          <a\r\n                            href=\"#\"\r\n                            class=\"dropdown-item\"\r\n                            onClick={() => DeleteMessage(message)}\r\n                          >\r\n                            Delete\r\n                          </a>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"message-avatar flex-end relative custom-time-holder\">\r\n                      <div className=\"custom-time\">\r\n                        <div className=\"time\">\r\n                          {timeSend} {ticks}\r\n                          {/* <Check /> */}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n      <div className=\"chat-footer\">\r\n        <form onSubmit={(event) => SendMessage(event, newMessage, chat_uid)}>\r\n          <div>\r\n            <button\r\n              className=\"btn btn-light mr-3\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Emoji\"\r\n              type=\"button\"\r\n            >\r\n              <Smile />\r\n            </button>\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            placeholder=\"Write a message.\"\r\n            value={newMessage}\r\n            onChange={(e) => setnewMessage(e.target.value)}\r\n          />\r\n          <div className=\"form-buttons\">\r\n            <button\r\n              className=\"btn btn-light\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Add files\"\r\n              type=\"button\"\r\n            >\r\n              <Paperclip />\r\n            </button>\r\n            <button\r\n              className=\"btn btn-light d-sm-none d-block\"\r\n              data-toggle=\"tooltip\"\r\n              title=\"Send a voice record\"\r\n              type=\"button\"\r\n            >\r\n              <Mic />\r\n            </button>\r\n            <button className=\"btn btn-primary\" type=\"submit\">\r\n              <Send />\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatBodyMessage;\r\n"]},"metadata":{},"sourceType":"module"}